<div class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-8 my-8">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800">Multilingual Excel Translator</h1>
      <p class="text-gray-500 mt-2">Upload an Excel file, choose a language, and let Gemini AI translate it for you.</p>
    </div>

    <!-- Step 1: API Key -->
    <div class="mb-6">
      <label for="apiKey" class="block text-sm font-medium text-gray-700 mb-2">
        <i class="fas fa-key mr-2 text-gray-400"></i>Enter your Gemini API Key
      </label>
      <div class="relative">
        <input 
          type="{{ showApiKey ? 'text' : 'password' }}" 
          id="apiKey" 
          [(ngModel)]="apiKey"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" 
          placeholder="Your API key goes here"
          aria-label="Gemini API Key"
          autocomplete="off">
        <button 
          type="button"
          (click)="toggleApiKeyVisibility()"
          class="absolute inset-y-0 right-0 px-4 text-gray-500 hover:text-gray-700"
          [attr.aria-label]="showApiKey ? 'Hide API key' : 'Show API key'">
          <i class="fas" [class.fa-eye]="!showApiKey" [class.fa-eye-slash]="showApiKey"></i>
        </button>
      </div>
    </div>

    <!-- Step 2: Upload and Language Selection -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          <i class="fas fa-file-excel mr-2 text-gray-400"></i>Upload Excel File
        </label>
        <div 
          class="file-drop-area relative border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onFileDropped($event)"
          role="button"
          tabindex="0"
          aria-label="File upload area"
          (keydown.enter)="fileInput.click()"
          (keydown.space)="fileInput.click()">
          <input 
            #fileInput
            type="file" 
            id="fileInput" 
            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" 
            accept=".xlsx, .xls"
            (change)="onFileSelected($event)"
            aria-label="Select Excel file">
          <div class="text-gray-500">
            <i class="fas fa-cloud-upload-alt text-4xl mb-3"></i>
            <p class="font-semibold" [class.text-blue-600]="selectedFile">{{ fileName }}</p>
            <p class="text-xs">Supported formats: .xlsx, .xls</p>
          </div>
        </div>
      </div>
      <div>
        <label for="language" class="block text-sm font-medium text-gray-700 mb-2">
          <i class="fas fa-language mr-2 text-gray-400"></i>Translate to
        </label>
        <select 
          id="language" 
          [(ngModel)]="selectedLanguage"
          (change)="onLanguageChange()"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 h-[108px]">
          <option value="Hindi">Hindi</option>
          <option value="Marathi">Marathi</option>
        </select>
      </div>
    </div>

    <!-- Step 3: Prompt Editor -->
    <div class="mb-6">
      <details open>
        <summary class="font-medium text-gray-700 flex justify-between items-center">
          <span><i class="fas fa-pencil-alt mr-2 text-gray-400"></i>Edit API Prompt for Selected Language</span>
          <i class="fas fa-chevron-down transition-transform"></i>
        </summary>
        <div class="mt-2">
          <textarea 
            id="promptInput" 
            rows="10" 
            [(ngModel)]="customPrompt"
            (input)="onPromptChange()"
            class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"></textarea>
        </div>
      </details>
    </div>

    <!-- Action Button -->
    <div class="text-center my-6">
      <button 
        type="button"
        (click)="translate()"
        [disabled]="isLoading"
        class="w-full md:w-1/2 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:scale-100">
        <i class="fas" [class.fa-spinner]="isLoading" [class.fa-sync-alt]="!isLoading" [class.fa-spin]="isLoading" class="mr-2"></i>
        {{ isLoading ? 'Translating...' : 'Translate' }}
      </button>
    </div>
    
    <!-- Status & Messages -->
    <div *ngIf="statusMessage" [class]="statusClasses" role="alert">
      {{ statusMessage }}
    </div>

    <!-- Preview & Download Section -->
    <div *ngIf="showResults" class="block">
      <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
        <div class="flex items-center gap-2">
          <h2 class="text-xl font-bold text-gray-700">Preview</h2>
          <div class="flex rounded-lg p-1 bg-gray-200">
            <button 
              type="button"
              (click)="toggleView(true)"
              class="view-toggle-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors"
              [class.active]="showTranslatedView"
              [class.inactive]="!showTranslatedView">
              Translated
            </button>
            <button 
              type="button"
              (click)="toggleView(false)"
              class="view-toggle-btn px-3 py-1 text-sm font-semibold rounded-md transition-colors"
              [class.active]="!showTranslatedView"
              [class.inactive]="showTranslatedView">
              Original
            </button>
          </div>
        </div>
        <button 
          type="button"
          (click)="downloadExcel()"
          class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105">
          <i class="fas fa-download mr-2"></i>Download Translated Excel
        </button>
      </div>
      <div id="preview-container" class="max-h-96 overflow-auto border border-gray-200 rounded-lg shadow-inner">
        <table *ngIf="displayData.length > 0" class="w-full border-collapse">
          <thead>
            <tr>
              <th *ngFor="let header of displayHeaders" class="border border-gray-300 px-2 py-1 bg-gray-50 text-left">
                {{ header }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of displayData">
              <td *ngFor="let header of displayHeaders" class="border border-gray-300 px-2 py-1 text-left">
                {{ row[header] }}
              </td>
            </tr>
          </tbody>
        </table>
        <p *ngIf="displayData.length === 0" class="p-4 text-center text-gray-500">
          No data to display.
        </p>
      </div>
    </div>
  </div>
</div>
